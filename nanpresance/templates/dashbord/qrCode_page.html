{% load qr_code  %}
<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
        <title>Veltrix - Admin Dashboard Template | Themesbrand</title>
        <meta content="Responsive admin theme build on top of Bootstrap 4" name="description" />
        <meta content="Themesbrand" name="author" />
        <link rel="shortcut icon" href="/static/assets/images/favicon.ico">

        <link href="/static/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="/static/assets/css/metismenu.min.css" rel="stylesheet" type="text/css">
        <link href="/static/assets/css/icons.css" rel="stylesheet" type="text/css">
        <link href="/static/assets/css/style.css" rel="stylesheet" type="text/css">
    </head>

    <body class="bg-primary">
        <div class="home-btn d-none d-sm-block">
            <a href="index.html" class="text-white"><i class="fas fa-home h2"></i></a>
        </div>

        <div class="account-pages my-5 pt-5">
            <div class="container">
                <div class="row justify-content-center">
                    <div>
                        <div class="card bg-pattern shadow-none">
                            <div class="card-body" id="app">
                                <div class="text-center mt-4">
                                    <div class="mb-3">
                                        <a href="index.html" class="logo"><img src="/static/assets/images/logo-light.png" height="20" alt="logo"></a>
                                        ${patrick}
                                    </div>
                                </div>
                                {% if  isQr %}
                                <div class="p-3"> 
                                        {% qr_from_text  myQr.titre_slug  size="m" image_format="png" error_correction="L" %}
                                </div>
                                {% endif %}
                                {% if not isQr %}
                                <div class="md-4">
                                    
                                    <div class="text-center">
                                        <img src="/static/img/undraw_security_o890.png" style="height: 250px;width: 250px;margin: 20px;text-align: center">
                                        <h5 class="font-14">Le code Qr est inactif </h5>
                                    </div>
                                </div>
                                {% endif %}
                    
                            </div>
                        </div>
                        <div class="mt-5 text-center text-white-50">
                            <p>Â© 2019 Veltrix. Crafted with <i class="mdi mdi-heart text-danger"></i> by Themesbrand</p>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <!-- jQuery  -->
        <script src="/static/assets/js/jquery.min.js"></script>
        <script src="/static/assets/js/bootstrap.bundle.min.js"></script>
        <script src="/static/assets/js/metismenu.min.js"></script>
        <script src="/static/assets/js/jquery.slimscroll.js"></script>
        <script src="/static/assets/js/waves.min.js"></script>

        <!-- App js -->
        <script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        var app =new Vue({
            el:'#app',
            data:{
                dateQr:'',
                patrick:"patrick",
                QrCode:"bonjour 2020",
                //
                //
                debutQr:document.getElementById('debutQr').value,
                finQr:document.getElementById('finQr').value,
                myMin:'',
                mySec:'',
                showQr:true,
                hDebutQr:'',
                hFinQr:'',
                isQr:document.getElementById('isQr').value=='False'?false:true,
                updatedCodeQr:false
                // dateToUpdate:document.getElementById('dateQr').innerHTML,
            },
            delimiters:["${","}"],
            mounted() {
                this.chono()
            },
            methods:{
                chono:function(){
                    seconde_fin =  parseInt(this.finQr.split(":")[0])*3600+parseInt(this.finQr.split(":")[1]*60)
                    date = new Date
                    curentSeconde = date.getHours()*3600 + date.getMinutes()*60 + date.getSeconds()
                    myChonoSec = seconde_fin - curentSeconde;
                    this.myMin = Math.floor(myChonoSec/60)
                    this.mySec = myChonoSec%60
                    console.log(this.myMin,this.mySec)
                },
                unActiveQrCode:function(){
                    new_dat =new Date(this.dateToUpdate);
                    this.isregister=true
                    axios.defaults.xsrfCookieName = 'csrftoken'
                    axios.defaults.xsrfHeaderName = 'X-CSRFToken'
                    axios.post('http://192.168.50.142:8000/unActiveQr', {

                        }).then(response => {
                            console.log(response)
                            if(response.data.success){
                                console.log("ok donne partie ")
                                this.showQr=false
                            }
                            else{
                                console.log("erreur ;-(")
                            }
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                }
            }
        })
        if(app.isQr){
            setInterval(
                function(){
                    if(app.mySec == 1){
                        app.myMin--
                        app.mySec=60
                    }
                    else{
                        app.mySec --
                    }
                    if(app.myMin < 0 ){
                        console.log("le temp est passe ",app.updatedCodeQr)
                        app.unActiveQrCode()

                    }
                },1000
            )
        }

    </script>

    </body>

</html>